<div class="container my-5">
  <div class="card shadow p-4 mx-auto" style="max-width: 700px;">
    <h2 class="text-center mb-4 text-primary">Post a Skill Exchange Request</h2>

    <% if @skill_exchange_request.errors.any? %>
      <div class="alert alert-danger">
        <h5><%= pluralize(@skill_exchange_request.errors.count, "error") %> prevented submission:</h5>
        <ul>
          <% @skill_exchange_request.errors.full_messages.each do |msg| %>
            <li><%= msg %></li>
          <% end %>
        </ul>
      </div>
    <% end %>

    <%= form_with model: @skill_exchange_request, class: "needs-validation" do |f| %>

      <div class="mb-4">
        <h5 class="small fw-semibold mb-2">Skill you can teach</h5>
        <div class="row g-2 align-items-center">
          <div class="col-md-4">
            <%= f.label :teach_category, "Category", class: "form-label form-label-sm" %>
            <%= f.select :teach_category,
                  options_for_select(SkillExchangeRequest::CATEGORIES.map { |k, v| [v, k] }, f.object.teach_category),
                  { include_blank: "Choose category" },
                  class: "form-select form-select-sm", required: true %>
          </div>
          <div class="col-md-8">
            <%= f.label :teach_skill, "Skill", class: "form-label form-label-sm" %>
            <%= f.text_field :teach_skill, class: "form-control form-control-sm",
                            placeholder: "e.g., Guitar, Linear Algebra, Photography", required: true %>
          </div>
          <div class="col-md-4 mt-2">
            <%= f.label :teach_level, "Teaching level", class: "form-label form-label-sm" %>
            <%= f.select :teach_level,
                          SkillExchangeRequest.teach_levels.keys.map { |k| [k.humanize, k] },
                          {}, class: "form-select form-select-sm", required: true %>
          </div>
        </div>
      </div>

      <div class="mb-4">
        <h5 class="small fw-semibold mb-2">Skill you want to learn</h5>
        <div class="row g-2 align-items-center">
          <div class="col-md-4">
            <%= f.label :learn_category, "Category", class: "form-label form-label-sm" %>
            <%= f.select :learn_category,
                  options_for_select(SkillExchangeRequest::CATEGORIES.map { |k, v| [v, k] }, f.object.learn_category),
                  { include_blank: "Choose category" },
                  class: "form-select form-select-sm", required: true %>
          </div>
          <div class="col-md-8">
            <%= f.label :learn_skill, "Skill", class: "form-label form-label-sm" %>
            <%= f.text_field :learn_skill, class: "form-control form-control-sm",
                            placeholder: "e.g., Python, UI/UX, Violin", required: true %>
          </div>
          <div class="col-md-4 mt-2">
            <%= f.label :learn_level, "Learning level", class: "form-label form-label-sm" %>
            <%= f.select :learn_level,
                          SkillExchangeRequest.learn_levels.keys.map { |k| [k.humanize, k] },
                          {}, class: "form-select form-select-sm", required: true %>
          </div>
        </div>
      </div>

      <div class="mb-3">
        <%= f.label :learning_goal, "Whatâ€™s your learning goal?", class: "form-label fw-semibold" %>
        <%= f.text_area :learning_goal, rows: 3, class: "form-control",
                        placeholder: "e.g., Build a small Python project or learn conversational Spanish." %>
      </div>

      <div class="row g-3">
        <div class="col-md-6">
          <%= f.label :offer_hours, "Hours you can offer to teach", class: "form-label fw-semibold" %>
          <%= f.number_field :offer_hours, in: 1..40, step: 1, class: "form-control", required: true %>
        </div>

        <div class="col-md-6">
          <%= f.label :expires_after_days, "Auto-expire after how many days?", class: "form-label fw-semibold" %>
          <%= f.number_field :expires_after_days, in: 7..180, step: 1, value: 30,
                            class: "form-control", required: true %>
        </div>
      </div>

      <div class="mt-3">
        <%= f.label :modality, "How do you want to meet?", class: "form-label fw-semibold" %>
        <%= f.select :modality, [["In person", "in_person"], ["Remote", "remote"], ["Hybrid", "hybrid"]],
                     {}, class: "form-select", required: true %>
      </div>

      <div class="mt-3">
        <%= f.label :availability_days, "Which days work for you?", class: "form-label fw-semibold" %>
        <div class="d-flex justify-content-center flex-nowrap gap-1">
          <% SkillExchangeRequest::DAYS.each_with_index do |day, i| %>
            <% value = i.to_s %>
            <% checked = (@skill_exchange_request.availability_days || []).map(&:to_s).include?(value) %>
            <div class="form-check form-check-inline mb-0 day-chip">
              <%= check_box_tag "skill_exchange_request[availability_days][]", value, checked,
                                class: "form-check-input", id: "day_#{i}" %>
              <%= label_tag "day_#{i}", day, class: "form-check-label" %>
            </div>
          <% end %>
        </div>
        <% if @skill_exchange_request.errors[:availability_days].present? %>
          <div class="text-danger mt-1 text-center"><%= @skill_exchange_request.errors[:availability_days].first %></div>
        <% else %>
          <div class="form-text text-center mt-1">
            Tip: pick multiple; we'll use these for matching.
          </div>
        <% end %>
      </div>

      <div class="mt-3">
        <%= f.label :notes, "Notes (optional)", class: "form-label fw-semibold" %>
        <%= f.text_area :notes, rows: 3, class: "form-control",
                        placeholder: "Preferred times, campus location, tools, or teaching style..." %>
      </div>

      <div class="text-center mt-4">
        <%= f.submit "Post Request", class: "btn btn-primary px-4 py-2" %>
      </div>
    <% end %>
  </div>
</div>
